--============================================================--
--  SAR SCRIPT - UI FRAMEWORK
--============================================================--

local SarScript = {}
SarScript.__index = SarScript

local UIS = game:GetService("UserInputService")

--============================================================--
-- WINDOW
--============================================================--

function SarScript:CreateWindow(title)
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame", ScreenGui)
    Main.Size = UDim2.new(0, 450, 0, 320)
    Main.Position = UDim2.new(0.5, -225, 0.5, -160)
    Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Main.Active = true
    Main.Draggable = true

    local TitleBar = Instance.new("TextLabel", Main)
    TitleBar.Size = UDim2.new(1, 0, 0, 35)
    TitleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    TitleBar.TextColor3 = Color3.new(1,1,1)
    TitleBar.Text = title
    TitleBar.TextSize = 20

    local TabsHolder = Instance.new("Frame", Main)
    TabsHolder.Size = UDim2.new(0, 120, 1, -35)
    TabsHolder.Position = UDim2.new(0, 0, 0, 35)
    TabsHolder.BackgroundColor3 = Color3.fromRGB(40,40,40)

    local Pages = Instance.new("Frame", Main)
    Pages.Size = UDim2.new(1, -120, 1, -35)
    Pages.Position = UDim2.new(0, 120, 0, 35)
    Pages.BackgroundTransparency = 1

    local UI = {
        Main = Main,
        TabsHolder = TabsHolder,
        Pages = Pages
    }

    -- Nút ẩn hiện UI
    UIS.InputBegan:Connect(function(key)
        if key.KeyCode == Enum.KeyCode.RightShift then
            Main.Visible = not Main.Visible
        end
    end)

    return setmetatable(UI, SorWindow)
end

--============================================================--
-- TAB SYSTEM
--============================================================--
SorWindow = {}
SorWindow.__index = SorWindow

function SorWindow:CreateTab(name)
    local button = Instance.new("TextButton", self.TabsHolder)
    button.Size = UDim2.new(1, 0, 0, 35)
    button.BackgroundColor3 = Color3.fromRGB(60,60,60)
    button.TextColor3 = Color3.new(1,1,1)
    button.Text = name

    local Page = Instance.new("Frame", self.Pages)
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundColor3 = Color3.fromRGB(25,25,25)
    Page.Visible = false

    button.MouseButton1Click:Connect(function()
        for _,p in pairs(self.Pages:GetChildren()) do
            if p:IsA("Frame") then p.Visible = false end
        end
        Page.Visible = true
    end)

    Page.Visible = true -- tab đầu tiên mở

    return setmetatable({Page = Page}, SorTab)
end

--============================================================--
-- TAB ELEMENTS (LABEL / BUTTON / TOGGLE / INPUT)
--============================================================--
SorTab = {}
SorTab.__index = SorTab

function SorTab:Label(text)
    local lbl = Instance.new("TextLabel", self.Page)
    lbl.Size = UDim2.new(1, -10, 0, 25)
    lbl.Position = UDim2.new(0, 5, 0, #self.Page:GetChildren()*30)
    lbl.BackgroundTransparency = 1
    lbl.TextColor3 = Color3.new(1,1,1)
    lbl.Text = text
    lbl.TextXAlignment = Enum.TextXAlignment.Left
end

function SorTab:Button(text, callback)
    local btn = Instance.new("TextButton", self.Page)
    btn.Size = UDim2.new(1, -10, 0, 30)
    btn.Position = UDim2.new(0, 5, 0, #self.Page:GetChildren()*30)
    btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = text

    btn.MouseButton1Click:Connect(callback)
end

function SorTab:Toggle(text, default, callback)
    local toggle = Instance.new("TextButton", self.Page)
    toggle.Size = UDim2.new(1, -10, 0, 30)
    toggle.Position = UDim2.new(0, 5, 0, #self.Page:GetChildren()*30)
    toggle.BackgroundColor3 = Color3.fromRGB(70,70,70)
    toggle.TextColor3 = Color3.new(1,1,1)

    local state = default
    toggle.Text = text.." : "..tostring(state)

    toggle.MouseButton1Click:Connect(function()
        state = not state
        toggle.Text = text.." : "..tostring(state)
        callback(state)
    end)
end

function SorTab:Input(title, placeholder, callback)
    local box = Instance.new("TextBox", self.Page)
    box.Size = UDim2.new(1, -10, 0, 30)
    box.Position = UDim2.new(0, 5, 0, #self.Page:GetChildren()*30)
    box.BackgroundColor3 = Color3.fromRGB(70,70,70)
    box.TextColor3 = Color3.new(1,1,1)
    box.PlaceholderText = placeholder
    box.Text = ""

    box.FocusLost:Connect(function()
        callback(box.Text)
    end)
end

--============================================================--
-- NOTIFICATION
--================================================------------

function SarScript:Notify(text)
    game.StarterGui:SetCore("SendNotification", {
        Title = "SarScript",
        Text = text,
        Duration = 3
    })
end

return SarScript
